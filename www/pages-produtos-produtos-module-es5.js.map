{"version":3,"sources":["webpack:///src/pages/produtos/produtos.page.html","webpack:///src/pages/produtos/produtos-routing.module.ts","webpack:///src/pages/produtos/produtos.module.ts","webpack:///src/pages/produtos/produtos.page.scss","webpack:///src/pages/produtos/produtos.page.ts"],"names":["routes","path","component","ProdutosPageRoutingModule","imports","forChild","exports","ProdutosPageModule","declarations","ProdutosPage","activatedRoute","service","page","items$","loadData","produtoDtos","categoriaId","snapshot","params","findByCategoria","categorias","linesPerPage","pipe","p","loadImageUrls","items","item","getSmallImageFromBucket","id","imageUrl","BUCKET_URL","lista","produto","event","setTimeout","target","complete","selector","template"],"mappings":"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","file":"pages-produtos-produtos-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar>\\n    <ion-title>Produtos</ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content padding *ngIf=\\\"items$ | async as items\\\">\\n  <ion-refresher slot=\\\"fixed\\\" (ionRefresh)=\\\"doRefresh($event)\\\">\\n    <ion-refresher-content></ion-refresher-content>\\n  </ion-refresher>\\n\\n  <ion-fab vertical=\\\"top\\\" horizontal=\\\"end\\\" edge slot=\\\"fixed\\\">\\n    <ion-fab-button routerLink=\\\"/cart\\\">\\n      <ion-icon name=\\\"cart\\\"></ion-icon>\\n    </ion-fab-button>\\n  </ion-fab>\\n\\n  <ion-list>\\n    <ion-item button *ngFor=\\\"let item of items\\\" routerLink=\\\"/produto-detail/{{item.id}}\\\">\\n      <ion-thumbnail slot=\\\"start\\\">\\n        <img [src]=\\\"item.imageUrl || 'assets/imgs/prod.jpg'\\\">\\n      </ion-thumbnail>\\n      <ion-label>\\n        <h2>{{item.nome}}</h2>\\n        <p>{{item.preco | currency}}</p>\\n      </ion-label>\\n    </ion-item>\\n  </ion-list>\\n\\n  <ion-infinite-scroll threshold=\\\"100px\\\" (ionInfinite)=\\\"doInfinite($event, items)\\\">\\n    <ion-infinite-scroll-content loadingSpinner=\\\"bubbles\\\" loadingText=\\\"Aguarde...\\\">\\n    </ion-infinite-scroll-content>\\n  </ion-infinite-scroll>\\n</ion-content>\";","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { ProdutosPage } from './produtos.page';\n\n\nconst routes: Routes = [\n  { path: ':categoriaId', component: ProdutosPage }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class ProdutosPageRoutingModule { }\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { ProdutosPageRoutingModule } from './produtos-routing.module';\n\nimport { ProdutosPage } from './produtos.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ProdutosPageRoutingModule\n  ],\n  declarations: [ProdutosPage]\n})\nexport class ProdutosPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvcGFnZXMvcHJvZHV0b3MvcHJvZHV0b3MucGFnZS5zY3NzIn0= */\";","import { Component } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { from, Observable } from 'rxjs';\nimport { map, mergeMap, reduce, switchMap, tap } from 'rxjs/operators';\nimport { environment } from 'src/environments/environment';\nimport { ProdutoService } from 'src/services/domain/produto.service';\nimport { ProdutoDTO } from './../../models/produto.dto';\n\n@Component({\n  selector: 'app-produtos',\n  templateUrl: './produtos.page.html',\n  styleUrls: ['./produtos.page.scss'],\n})\nexport class ProdutosPage {\n  page = 0;\n  items$: Observable<ProdutoDTO[]>;\n\n  constructor(\n    private activatedRoute: ActivatedRoute,\n    private service: ProdutoService,\n  ) {\n    this.items$ = this.loadData();\n  }\n\n  loadData(produtoDtos?: ProdutoDTO[]) {\n    const categoriaId = this.activatedRoute.snapshot.params.categoriaId;\n    return this.service.findByCategoria({ categorias: `${categoriaId}`, page: `${this.page}`, linesPerPage: `${10}` }).pipe(\n      map(p => {\n        if (produtoDtos) return [...p, ...produtoDtos]\n        return p;\n      }),\n      switchMap(p => this.loadImageUrls(p)),\n    );\n  }\n\n  loadImageUrls(items: ProdutoDTO[]) {\n    return from(items).pipe(\n      mergeMap(item => {\n        return this.service.getSmallImageFromBucket(item.id).pipe(\n          map<Blob, ProdutoDTO>(() => ({ ...item, imageUrl: `${environment.BUCKET_URL}/prod${item.id}-small.jpg` })),\n        );\n      }),\n      reduce<ProdutoDTO, ProdutoDTO[]>((lista, produto) => [...lista, produto], []),\n    );\n  }\n\n  doRefresh(event) {\n    this.items$ = this.loadData().pipe(\n      tap(() => this.page = 0),\n      tap(() => setTimeout(() => event.target.complete(), 500))\n    );\n  }\n\n  doInfinite(event, items: ProdutoDTO[]) {\n    this.items$ = this.loadData(items).pipe(\n      tap(() => this.page++),\n      tap(() => setTimeout(() => event.target.complete(), 500))\n    );\n  }\n}\n"]}